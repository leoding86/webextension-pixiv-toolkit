!function e(n,t,i){function r(a,s){if(!t[a]){if(!n[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=t[a]={exports:{}};n[a][0].call(u.exports,function(e){var t=n[a][1][e];return r(t?t:e)},u,u.exports,e,n,t,i)}return t[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,n,t){!function(){"use strict";var i=e("./js/util/console")(),r=e("./js/util/slugify");e("./js/util/handlebar-helpers");var o={"idpf-wasteland":e("../src/js/template-builders/idpf-wasteland-builder.js").builder,lightnovel:e("../src/js/template-builders/lightnovel-builder.js").builder},a=function(){var e=this,n={toc:[],landmarks:[],sections:[],stylesheet:{},additionalFiles:[],options:{}};this.withUuid=function(t){return n.uuid=t,e},this.withTemplate=function(t){return n.templateName=t,e},this.withTitle=function(t){return n.title=t,n.slug=r(t),e},this.withLanguage=function(t){return n.lang=t,e},this.withAuthor=function(t){return n.author=t,e},this.withPublisher=function(t){return n.publisher=t,e},this.withModificationDate=function(t){return n.modificationDate=t.toISOString(),n.modificationDateYMD=n.modificationDate.substr(0,10),e},this.withRights=function(t){return n.rights=t,e},this.withCover=function(t,i){return n.coverUrl=t,n.coverRights=i,e},this.withAttributionUrl=function(t){return n.attributionUrl=t,e},this.withStylesheetUrl=function(t,i){return n.stylesheet={url:t,styles:"",replaceOriginal:i},e},this.withSection=function(t){return n.sections.push(t),Array.prototype.push.apply(n.toc,t.collectToc()),Array.prototype.push.apply(n.landmarks,t.collectLandmarks()),e},this.withAdditionalFile=function(t,i,r){return n.additionalFiles.push({url:t,folder:i,filename:r}),e},this.withOption=function(t,i){return n.options[t]=i,e},this.makeEpub=function(){return n.publicationDate=(new Date).toISOString(),n.publicationDateYMD=n.publicationDate.substr(0,10),o[n.templateName].make(n).then(function(e){i.info("generating epub for: "+n.title);var t=e.generate({type:"blob",mimeType:"application/epub+zip",compression:"DEFLATE"});return t})},this.downloadEpub=function(t,r){e.makeEpub().then(function(e){var o;o=r?n.title+".epub":n.slug+".epub",i.debug('saving "'+o+'"...'),t&&"function"==typeof t&&t(e,o),saveAs(e,o)})}};if(a.epubtypes=e("../src/js/epub-types.js"),a.Section=function(e,n,t,i,r){function o(e,n){for(var t=e[n]?[e]:[],i=0;i<e.subSections.length;i++)Array.prototype.push.apply(t,o(e.subSections[i],n));return t}var a=this;this.epubType=e,this.id=n,this.content=t,this.includeInToc=i,this.includeInLandmarks=r,this.subSections=[],t&&(t.renderTitle=t.renderTitle!==!1),this.withSubSection=function(e){return a.subSections.push(e),a},this.collectToc=function(){return o(this,"includeInToc")},this.collectLandmarks=function(){return o(this,"includeInLandmarks")}},"undefined"!=typeof n)n.exports.EpubMaker=a;else if("undefined"!=typeof t)t.EpubMaker=a;else if("undefined"==typeof window)throw new Error("unable to expose EpubMaker: no module, exports object and no global window detected");"undefined"!=typeof window&&(window.EpubMaker=a)}()},{"../src/js/epub-types.js":4,"../src/js/template-builders/idpf-wasteland-builder.js":5,"../src/js/template-builders/lightnovel-builder.js":6,"./js/util/console":8,"./js/util/handlebar-helpers":9,"./js/util/slugify":10}],2:[function(e,n,t){function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===i||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(n){try{return f.call(null,e,0)}catch(n){return f.call(this,e,0)}}}function a(e){if(p===clearTimeout)return clearTimeout(e);if((p===r||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(n){try{return p.call(null,e)}catch(n){return p.call(this,e)}}}function s(){g&&h&&(g=!1,h.length?m=h.concat(m):y=-1,m.length&&c())}function c(){if(!g){var e=o(s);g=!0;for(var n=m.length;n;){for(h=m,m=[];++y<n;)h&&h[y].run();y=-1,n=m.length}h=null,g=!1,a(e)}}function l(e,n){this.fun=e,this.array=n}function u(){}var f,p,d=n.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:i}catch(e){f=i}try{p="function"==typeof clearTimeout?clearTimeout:r}catch(e){p=r}}();var h,m=[],g=!1,y=-1;d.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];m.push(new l(e,n)),1!==m.length||g||o(c)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.prependListener=u,d.prependOnceListener=u,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],3:[function(e,n,t){(function(e){!function(t){"use strict";function i(e){d(function(){throw e})}function r(e){return this.then(e,t)}function o(e){return this.then(t,e)}function a(e,n){return this.then(function(n){return h(e)?e.apply(null,m(n)?n:[n]):k.onlyFuncs?n:e},n||t)}function s(e){function n(){e()}return this.then(n,n),this}function c(e){return this.then(function(n){return h(e)?e.apply(null,m(n)?n.splice(0,0,void 0)&&n:[void 0,n]):k.onlyFuncs?n:e},function(n){return e(n)})}function l(e){return this.then(t,e?function(n){throw e(n),n}:i)}function u(e,n){var t=v(e);if(1===t.length&&m(t[0])){if(!t[0].length)return k.fulfilled([]);t=t[0]}var i=[],r=k(),o=t.length;if(o)for(var a=function(e){t[e]=k.promisify(t[e]),t[e].then(function(a){i[e]=n?t[e]:a,--o||r.resolve(i)},function(a){n?(i[e]=t[e],--o||r.resolve(i)):r.reject(a)})},s=0,c=o;s<c;s++)a(s);else r.resolve(i);return r.promise}function f(e,n){return e.then(h(n)?n:function(){return n})}function p(e){var n=v(e);1===n.length&&m(n[0])&&(n=n[0]);for(var t=k(),i=0,r=n.length,o=k.resolved();i<r;i++)o=f(o,n[i]);return t.resolve(o),t.promise}var d,h=function(e){return"function"==typeof e},m=function(e){return Array.isArray?Array.isArray(e):e instanceof Array},g=function(e){return!(!e||!(typeof e).match(/function|object/))},y=function(e){return e===!1||e===t||null===e},v=function(e,n){return[].slice.call(e,n)},b="undefined",w=typeof TypeError===b?Error:TypeError;if(typeof e!==b&&e.nextTick)d=e.nextTick;else if(typeof MessageChannel!==b){var x=new MessageChannel,T=[];x.port1.onmessage=function(){T.length&&T.shift()()},d=function(e){T.push(e),x.port2.postMessage(0)}}else d=function(e){setTimeout(e,0)};var k=function(e){function n(){if(0!==m){var e,n=v,t=0,i=n.length,r=~m?0:1;for(v=[];t<i;t++)(e=n[t][r])&&e(f)}}function i(e){function t(e){return function(n){return r?void 0:(r=!0,e(n))}}var r=!1;if(m)return this;try{var o=g(e)&&e.then;if(h(o)){if(e===b)throw new w("Promise can't resolve itself");return o.call(e,t(i),t(u)),this}}catch(a){return t(u)(a),this}return p(function(){f=e,m=1,n()}),this}function u(e){return m||p(function(){try{throw e}catch(t){f=t}m=-1,n()}),this}var f,p=(t!==e?e:k.alwaysAsync)?d:function(e){e()},m=0,v=[],b={then:function(e,t){var i=k();return v.push([function(n){try{y(e)?i.resolve(n):i.resolve(h(e)?e(n):k.onlyFuncs?n:e)}catch(t){i.reject(t)}},function(e){if((y(t)||!h(t)&&k.onlyFuncs)&&i.reject(e),t)try{i.resolve(h(t)?t(e):t)}catch(n){i.reject(n)}}]),0!==m&&p(n),i.promise},success:r,error:o,otherwise:o,apply:a,spread:a,ensure:s,nodify:c,rethrow:l,isPending:function(){return 0===m},getStatus:function(){return m}};return b.toSource=b.toString=b.valueOf=function(){return f===t?this:f},{promise:b,resolve:i,fulfill:i,reject:u}};if(k.deferred=k.defer=k,k.nextTick=d,k.alwaysAsync=!0,k.onlyFuncs=!0,k.resolved=k.fulfilled=function(e){return k(!0).resolve(e).promise},k.rejected=function(e){return k(!0).reject(e).promise},k.wait=function(e){var n=k();return setTimeout(n.resolve,e||0),n.promise},k.delay=function(e,n){var t=k();return setTimeout(function(){try{t.resolve(h(e)?e.apply(null):e)}catch(n){t.reject(n)}},n||0),t.promise},k.promisify=function(e){return e&&h(e.then)?e:k.resolved(e)},k.all=function(){return u(arguments,!1)},k.resolveAll=function(){return u(arguments,!0)},k.sequence=function(){return p(arguments)},k.nodeCapsule=function(e,n){return n||(n=e,e=void 0),function(){var t=k(),i=v(arguments);i.push(function(e,n){e?t.reject(e):t.resolve(arguments.length>2?v(arguments,1):n)});try{n.apply(e,i)}catch(r){t.reject(r)}return t.promise}},"function"==typeof define&&define.amd)define("D.js",[],function(){return k});else if(typeof n!==b&&n.exports)n.exports=k;else if(typeof window!==b){var j=window.D;k.noConflict=function(){return window.D=j,k},window.D=k}}()}).call(this,e("_process"))},{_process:2}],4:[function(e,n,t){!function(){"use strict";function e(e){return{"abstract":"frontmatter",foreword:"frontmatter",preface:"frontmatter",introduction:"frontmatter",preamble:"frontmatter",epigraph:"frontmatter","non-specific frontmatter":"frontmatter",part:"bodymatter",chapter:"bodymatter",prologue:"bodymatter",conclusion:"bodymatter",epilogue:"bodymatter",afterword:"backmatter","non-specific backmatter":"backmatter",rearnote:"backmatter"}[e]}for(var t=[{name:"abstract",group:"Front Matter",description:"A short summary of the principle ideas, concepts and conclusions of the work, or of a section or except within it."},{name:"foreword",group:"Front Matter",description:"An introductory section that precedes the work, typically not written by the work's author."},{name:"preface",group:"Front Matter",description:"An introductory section that precedes the work, typically written by the work's author."},{name:"introduction",group:"Front Matter",description:"A section in the beginning of the work, typically introducing the reader to the scope or nature of the work's content."},{name:"preamble",group:"Front Matter",description:"A section in the beginning of the work, typically containing introductory and/or explanatory prose regarding the scope or nature of the work's content"},{name:"epigraph",group:"Front Matter",description:"A quotation that is pertinent but not integral to the text."},{name:"non-specific frontmatter",group:"Front Matter",description:"Content placed in the frontmatter section, but which has no specific semantic meaning."},{name:"part",group:"Body Matter",description:"An introductory section that sets the background to a story, typically part of the narrative."},{name:"chapter",group:"Body Matter",description:"An introductory section that sets the background to a story, typically part of the narrative."},{name:"prologue",group:"Body Matter",description:"An introductory section that sets the background to a story, typically part of the narrative."},{name:"conclusion",group:"Body Matter",description:"An ending section that typically wraps up the work."},{name:"epilogue",group:"Body Matter",description:"A concluding section that is typically written from a later point in time than the main story, although still part of the narrative."},{name:"afterword",group:"Back Matter",description:"A closing statement from the author or a person of importance to the story, typically providing insight into how the story came to be written, its significance or related events that have transpired since its timeline."},{name:"non-specific backmatter",group:"Back Matter",description:"Content placed in the backmatter section, but which has no specific semantic meaning."},{name:"rearnote",group:"Back Matter",description:"A note appearing in the rear (backmatter) of the work, or at the end of a section."}],i={},r=0;r<t.length;r++){var o=t[r].group;(i[o]||(i[o]=[])).push(t[r])}n.exports={types:t,groups:i,getGroup:e}}()},{}],5:[function(e,n,t){!function(){"use strict";var i=e("d.js"),r=e("../../js/util/console")(),o=e("../../js/util/ajax"),a={mimetype:"application/epub+zip",container:'<?xml version="1.0" encoding="UTF-8"?>\n<container xmlns="urn:oasis:names:tc:opendocument:xmlns:container" version="1.0">\n\t<rootfiles>\n\t\t<rootfile full-path="EPUB/{{slug}}.opf" \t\n\t\t\tmedia-type="application/oebps-package+xml"/>\n\t</rootfiles>\n</container>',opf:'<?xml version="1.0" encoding="UTF-8"?>\n<package xmlns="http://www.idpf.org/2007/opf" version="3.0" unique-identifier="uid" xml:lang="en-US" prefix="cc: http://creativecommons.org/ns#">\n    <metadata xmlns:dc="http://purl.org/dc/elements/1.1/">\n        <dc:identifier id="uid">{{uuid}}</dc:identifier>\n        <dc:title>{{title}}</dc:title>\n        <dc:creator>{{author}}</dc:creator>\n        <dc:language>{{lang}}</dc:language>\n        <dc:date>{{publicationDate}}</dc:date>\n        <meta property="dcterms:modified">{{modificationDate}}</meta>\n        {{#if rights}}\n            <!-- rights expressions for the work as a whole -->\n            {{#if rights.description}}<dc:rights>{{rights.description}}</dc:rights>{{/if}}\n            {{#if rights.license}}<link rel="cc:license" href="{{rights.license}}"/>{{/if}}\n            {{#if rights.attributionUrl}}<meta property="cc:attributionURL">{{attributionUrl}}</meta>{{/if}}\n        {{/if}}\n        {{#if coverUrl}}\n            {{#if coverRights}}\n                <!-- rights expression for the cover image -->       \n                {{#if coverRights.license}}<link rel="cc:license" refines="#cover" href="{{coverRights.license}}" />{{/if}}\n                {{#if coverRights.attributionUrl}}<link rel="cc:attributionURL" refines="#cover" href="{{coverRights.attributionUrl}}" />{{/if}}\n            {{/if}}\n                <!-- cover meta element included for 2.0 reading system compatibility: -->\n                <meta name="cover" content="cover"/>\n        {{/if}}\n    </metadata>\n    <manifest>\n        <item id="t1" href="{{slug}}-content.xhtml" media-type="application/xhtml+xml" />\n        <item id="nav" href="{{slug}}-nav.xhtml" properties="nav" media-type="application/xhtml+xml" />\n        {{#if coverUrl}}\n        <item id="cover" href="{{slug}}-cover.{{extension coverUrl}}" media-type="{{mimetype coverUrl}}" properties="cover-image" />\n        {{/if}}\n        <item id="css" href="{{slug}}.css" media-type="text/css" />\n        <!-- ncx included for 2.0 reading system compatibility: -->\n        <item id="ncx" href="{{slug}}.ncx" media-type="application/x-dtbncx+xml" />\n    </manifest>\n    <spine toc="ncx">\n        <itemref idref="t1" />        \n    </spine>    \n</package>\n',ncx:'<?xml version="1.0" encoding="UTF-8"?>\n<ncx xmlns:ncx="http://www.daisy.org/z3986/2005/ncx/" xmlns="http://www.daisy.org/z3986/2005/ncx/"\n    version="2005-1" xml:lang="en">\n    <head>\n        <meta name="dtb:uid" content="{{uuid}}"/>\n    </head>\n    <docTitle>\n        <text>{{title}}</text>\n    </docTitle>\n    <navMap>\n        <!-- 2.01 NCX: playOrder is optional -->\n\t\t{{#each toc}}\n        <navPoint id="{{id}}">\n            <navLabel>\n                <text>{{content.title}}</text>\n            </navLabel>\n            <content src="{{../slug}}-content.xhtml#{{id}}"/>\n        </navPoint>\n\t\t{{/each}}\n    </navMap>\n</ncx>\n',nav:'<?xml version="1.0" encoding="UTF-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n\txmlns:epub="http://www.idpf.org/2007/ops">\n\t<head>\n\t\t<meta charset="utf-8"></meta>\t\t\n\t\t<link rel="stylesheet" type="text/css" href="{{slug}}.css" class="day" title="day"/> \n\t</head>\n\t<body>\n\t\t<nav epub:type="toc" id="toc">\n\t\t\t<ol>\n\t\t\t\t{{#each toc}}\n\t\t\t\t<li><a href="{{../slug}}-content.xhtml#{{id}}">{{content.title}}</a></li>\n\t\t\t\t{{/each}}\n\t\t\t</ol>\t\t\t\n\t\t</nav>\n\t\t<nav epub:type="landmarks">\n\t\t\t<ol>\n\t\t\t\t{{#each landmarks}}\n\t\t\t\t<li><a epub:type="{{epubType}}" href="{{../slug}}-content.xhtml#{{id}}">{{#if content.title}}{{content.title}}{{else}}{{epubType}}{{/if}}</a></li>\n\t\t\t\t{{/each}}\n\t\t\t</ol>\n\t\t</nav>\n\t</body>\n</html>\n',css:'@charset "UTF-8";\n@namespace "http://www.w3.org/1999/xhtml";\n@namespace epub "http://www.idpf.org/2007/ops";\n\nbody {\n    margin-left: 6em;\n    margin-right: 2em;\n    color: black;\n    font-family: times, \'times new roman\', serif;\n    background-color: rgb(255,255,245);\n    line-height: 1.5em;\n}\n\nh2 {\n    margin-top: 5em;\n    margin-bottom: 2em;\n}\n\nh3 {\n    margin-top: 3em;\n}\n\n.linegroup {\n    margin-top: 1.6em;\n}\n\nspan.lnum {\n    float: right;\n    color: gray;\n    font-size : 90%;\n}\n\na.noteref {\n    color: rgb(215,215,195);\n    text-decoration: none;\n    margin-left: 0.5em;\n    margin-right: 0.5em;\n}\n\nsection#rearnotes a {\n    color: black;\n    text-decoration: none;\n    border-bottom : 1px dotted gray;\n    margin-right: 0.8em;\n}\n\n.indent {\n    padding-left: 3em;\n}\n\n.indent2 {\n    padding-left: 5em;\n}\n\n*[epub|type~=\'dedication\'] {\n    padding-left: 2em;\n}\n',content:'<?xml version="1.0" encoding="UTF-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" xmlns:epub="http://www.idpf.org/2007/ops">\n\t<head>\n\t\t<meta charset="utf-8"></meta>\n\t\t<title>{{title}}</title>\n\t\t<link rel="stylesheet" type="text/css" href="{{slug}}.css" class="day" title="day"/> \n\t</head>\n\t<body>\n\t\t{{#each sections}}{{> sectionTemplate}}{{/each}}\n\t</body>\n</html>\n',sectionsTemplate:'{{!-- strange if-construction, but this is a workaround for gulp-js-html-inject, whose minifier wreaks havoc otherwise --}}\n{{#if epubType}}<section epub:type="{{epubType}}" id="{{id}}">{{else}}<section id="{{id}}">{{/if}}\n\n    {{#if content.renderTitle}}<h2>{{content.title}}</h2>{{/if}} \n    {{#if content.content}}{{{content.content}}}{{/if}}\n    \n    {{#each subSections}} {{> sectionTemplate}} {{/each}}\n    \n{{#if epubType}}</section>{{else}}</section>{{/if}}'},s=function(){function e(e){e.file("mimetype",a.mimetype)}function n(e,n){e.folder("META-INF").file("container.xml",p(a.container,n))}function t(e,n){e.folder("EPUB").file(n.slug+".opf",p(a.opf,n))}function s(e,n){var t=i();return n.coverUrl?JSZipUtils.getBinaryContent(n.coverUrl,function(i,r){if(i)t.reject(i);else{var o=n.coverUrl.substr(n.coverUrl.lastIndexOf(".")+1);e.folder("EPUB").file(n.slug+"-cover."+o,r,{binary:!0}),t.resolve("")}}):t.resolve(!0),t.promise}function c(e,n){e.folder("EPUB").file(n.slug+".ncx",p(a.ncx,n))}function l(e,n){e.folder("EPUB").file(n.slug+"-nav.xhtml",p(a.nav,n))}function u(e,n){function t(){var t={original:n.stylesheet.replaceOriginal?"":a.css,custom:n.styles};e.folder("EPUB").file(n.slug+".css",p("{{{original}}}{{{custom}}}",t,!0)),r.resolve(!0)}var r=i();return n.stylesheet.url?o(n.stylesheet.url).then(function(e){n.styles=e.data,t()}):(t(),r.promise)}function f(e,n){Handlebars.registerPartial("sectionTemplate",a.sectionsTemplate),e.folder("EPUB").file(n.slug+"-content.xhtml",p(a.content,n))}function p(e,n,t){function i(e){return t||"undefined"==typeof html_beautify?e:html_beautify(e,{end_with_newline:!1,indent_char:"\t",indent_inner_html:!0,indent_size:"1",preserve_newlines:!1,wrap_line_length:"0",unformatted:[],selector_separator_newline:!1,newline_between_rules:!0})}return i(Handlebars.compile(e)(n))}this.make=function(o){r.debug("building epub",o);var a=new JSZip,p=i();return i.all(e(a),n(a,o),t(a,o),s(a,o),c(a,o),l(a,o),u(a,o),f(a,o)).then(function(){p.resolve(a)}),p.promise}};if("undefined"!=typeof n)n.exports.builder=new s;else if("undefined"!=typeof t)t.builder=new s;else if("undefined"==typeof window)throw new Error("unable to expose module: no module, exports object and no global window detected");"undefined"!=typeof window&&(window.epubMaker=new s)}()},{"../../js/util/ajax":7,"../../js/util/console":8,"d.js":3}],6:[function(e,n,t){!function(){"use strict";var i=e("d.js"),r=e("../../js/util/console")(),o=e("../../js/util/ajax"),a={mimetype:"application/epub+zip",container:'<?xml version="1.0" encoding="UTF-8"?>\n<container xmlns="urn:oasis:names:tc:opendocument:xmlns:container" version="1.0">\n\t<rootfiles>\n\t\t<rootfile full-path="EPUB/lightnovel.opf"\n\t\t\tmedia-type="application/oebps-package+xml"/>\n\t</rootfiles>\n</container>',opf:'<?xml version="1.0" encoding="UTF-8"?>\n<package xmlns="http://www.idpf.org/2007/opf" version="3.0" unique-identifier="uid" xml:lang="en-US" prefix="cc: http://creativecommons.org/ns#">\n    <metadata xmlns:dc="http://purl.org/dc/elements/1.1/">\n        <dc:identifier id="uid">{{uuid}}</dc:identifier>\n        <dc:title>{{title}}</dc:title>\n        <dc:creator>{{author}}</dc:creator>\n        <dc:language>{{lang}}</dc:language>\n        <dc:date>{{publicationDate}}</dc:date>\n        <meta property="dcterms:modified">{{modificationDate}}</meta>\n        {{#if rights}}\n            <!-- rights expressions for the work as a whole -->\n            {{#if rights.description}}<dc:rights>{{rights.description}}</dc:rights>{{/if}}\n            {{#if rights.license}}<link rel="cc:license" href="{{rights.license}}"/>{{/if}}\n            {{#if rights.attributionUrl}}<meta property="cc:attributionURL">{{attributionUrl}}</meta>{{/if}}\n        {{/if}}\n        {{#if coverUrl}}\n            {{#if coverRights}}\n                <!-- rights expression for the cover image -->       \n                {{#if coverRights.license}}<link rel="cc:license" refines="#cover" href="{{coverRights.license}}" />{{/if}}\n                {{#if coverRights.attributionUrl}}<link rel="cc:attributionURL" refines="#cover" href="{{coverRights.attributionUrl}}" />{{/if}}\n            {{/if}}\n                <!-- cover meta element included for 2.0 reading system compatibility: -->\n                <meta name="cover" content="cover"/>\n        {{/if}}\n    </metadata>\n    <manifest>\n        {{#each sections}}{{> sectionsOPFManifestTemplate}}{{/each}}\n        <item id="nav" href="nav.html" properties="nav" media-type="application/xhtml+xml" />\n        {{#each additionalFiles}}\n        <item id="{{filename}}" href="{{folder}}/{{filename}}" media-type="{{mimetype filename}}" />\n        {{/each}}\n        {{#if coverUrl}}\n        <item id="cover" href="images/{{options.coverFilename}}" media-type="{{mimetype options.coverFilename}}" properties="cover-image" />\n        {{/if}}\n        <item id="css" href="css/main.css" media-type="text/css" />\n        <!-- ncx included for 2.0 reading system compatibility: -->\n        <item id="ncx" href="lightnovel.ncx" media-type="application/x-dtbncx+xml" />\n    </manifest>\n    <spine toc="ncx">\n        <itemref idref="nav" />\n        {{#each sections}}{{> sectionsOPFSpineTemplate}}{{/each}}\n    </spine>\n    <guide>\n        <reference type="toc" href="nav.html"/>\n    </guide>\n</package>\n',ncx:'<?xml version="1.0" encoding="UTF-8"?>\n<ncx xmlns:ncx="http://www.daisy.org/z3986/2005/ncx/" xmlns="http://www.daisy.org/z3986/2005/ncx/"\n    version="2005-1" xml:lang="en">\n    <head>\n        <meta name="dtb:uid" content="{{uuid}}"/>\n    </head>\n    <docTitle>\n        <text>{{title}}</text>\n    </docTitle>\n    <docAuthor>\n        <text>{{author}}</text>\n    </docAuthor>\n    <navMap>\n        <!-- 2.01 NCX: playOrder is optional -->\n        {{#each sections}}{{> sectionsNCXTemplate}}{{/each}}\n    </navMap>\n</ncx>\n',nav:'<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset="utf-8">\n        <title>{{options.tocName}}</title>\n        <link rel="stylesheet" type="text/css" href="css/main.css"> \n    </head>\n    <body>\n        <div class="cover divimage">\n            <img src="images/{{options.coverFilename}}" alt="Cover" />\n        </div>\n        <div class="center">\n            <h1>{{title}}</h1>\n            <div>{{author}}</div>\n            <div>{{publisher}}</div>\n            <div>{{modificationDateYMD}}</div>\n        </div>\n\n        <nav epub:type="toc" id="toc">\n            <ol>\n                {{#each sections}}{{> sectionsNavTemplate}}{{/each}}\n            </ol>\n        </nav>\n        <nav class="hidden" epub:type="landmarks">\n            <ol>\n                <li><a epub:type="toc" href="#toc">{{options.tocName}}</a></li>\n            </ol>\n        </nav>\n    </body>\n</html>\n',css:'@charset "UTF-8";\n@namespace "http://www.w3.org/1999/xhtml";\n@namespace epub "http://www.idpf.org/2007/ops";\n\nbody {\n    padding: 0%;\n    margin-top: 0%;\n    margin-bottom: 0%;\n    margin-left: 1%;\n    margin-right: 1%;\n    line-height: 130%;\n    text-align: justify;\n    background-color: rgb(255, 255, 245);\n}\n\ndiv {\n    margin: 0px;\n    padding: 0px;\n    line-height: 130%;\n    text-align: justify;\n}\n\np {\n    text-align: justify;\n    text-indent: 2em;\n    line-height: 130%;\n    margin-bottom: -0.8em;\n}\n\n.divimage {\n    page-break-after: always;\n}\n\n.cover {\n    width: 100%;\n    padding: 0px;\n}\n\n.center {\n    text-align: center;\n    margin-left: 0%;\n    margin-right: 0%;\n}\n\n.left {\n    text-align: center;\n    margin-left: 0%;\n    margin-right: 0%;\n}\n\n.right {\n    text-align: right;\n    margin-left: 0%;\n    margin-right: 0%;\n}\n\n.quote {\n    margin-top: 0%;\n    margin-bottom: 0%;\n    margin-left: 1em;\n    margin-right: 1em;\n    text-align: justify;\n}\n\n.hidden {\n    display: none;\n}\n\nh1 {\n    line-height: 130%;\n    text-align: center;\n    font-weight: bold;\n    font-size: xx-large;\n}\n\nh2 {\n    line-height: 130%;\n    text-align: center;\n    font-weight: bold;\n    font-size: x-large;\n}\n\nh3 {\n    line-height: 130%;\n    text-align: center;\n    font-weight: bold;\n    font-size: large;\n}\n\nh4 {\n    line-height: 130%;\n    text-align: center;\n    font-weight: bold;\n    font-size: medium;\n}\n\nh5 {\n    line-height: 130%;\n    text-align: center;\n    font-weight: bold;\n    font-size: small;\n}\n\nh6 {\n    line-height: 130%;\n    text-align: center;\n    font-weight: bold;\n    font-size: x-small;\n}\n',content:'<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset="utf-8">\n        <title>{{content.fullTitle}}</title>\n        <link rel="stylesheet" type="text/css" href="css/main.css"> \n    </head>\n    <body>\n        {{#if content.renderTitle}}<h2>{{content.title}}</h2>{{/if}} \n        {{#if content.content}}{{{content.content}}}{{/if}}\n    </body>\n</html>\n',autoToc:'<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset="utf-8">\n        <title>{{content.fullTitle}}</title>\n        <link rel="stylesheet" type="text/css" href="css/main.css"> \n    </head>\n    <body>\n        {{#if content.renderTitle}}<h2>{{content.title}}</h2>{{/if}}\n        {{#if subSections}}\n        <ol>\n            {{#each subSections}}{{> sectionsNavTemplate}}{{/each}}\n        </ol>\n        {{/if}}\n    </body>\n</html>\n',sectionsNavTemplate:'\n<li>\n    {{#if needPage}}\n    <a href="{{name}}.html">{{content.title}}</a>\n    {{/if}}\n    {{#if subSections}}\n    <ol>\n        {{#each subSections}}{{> sectionsNavTemplate}}{{/each}}\n    </ol>\n    {{/if}}\n</li>\n',sectionsNCXTemplate:'\n<navPoint id="{{name}}">\n    <navLabel>\n        <text>{{content.title}}</text>\n    </navLabel>\n    {{#if needPage}}\n    <content src="{{name}}.html"/>\n    {{/if}}\n    {{#each subSections}} {{> sectionsNCXTemplate}} {{/each}}\n</navPoint>\n',sectionsOPFManifestTemplate:'{{#if needPage}}\n<item id="{{name}}" href="{{name}}.html" media-type="application/xhtml+xml" />\n{{/if}}\n{{#each subSections}}{{> sectionsOPFManifestTemplate}}{{/each}}\n',sectionsOPFSpineTemplate:'<itemref idref="{{name}}" />\n{{#each subSections}}{{> sectionsOPFSpineTemplate}}{{/each}}\n'},s=function(){function e(n,t,i){n.content||(n.content={}),t?(t=n.content.fullTitle=t+" - "+n.content.title,i=n.name=i+"-"+n.rank):(t=n.content.fullTitle=n.content.title,i=n.name=""+n.rank),(n.content.content||n.content.renderTitle||"auto-toc"==n.epubType)&&(n.needPage=!0);for(var r=0;r<n.subSections.length;r++)n.subSections[r].rank=r,e(n.subSections[r],t,i)}function n(n){n.options.tocName=n.options.tocName||"Menu";for(var t=0;t<n.sections.length;t++)n.sections[t].rank=t,e(n.sections[t])}function t(e){e.file("mimetype",a.mimetype)}function s(e,n){e.folder("META-INF").file("container.xml",g(a.container,n))}function c(e,n){Handlebars.registerPartial("sectionsOPFManifestTemplate",a.sectionsOPFManifestTemplate),Handlebars.registerPartial("sectionsOPFSpineTemplate",a.sectionsOPFSpineTemplate),e.folder("EPUB").file("lightnovel.opf",g(a.opf,n))}function l(e,n){var t=i();return n.coverUrl?JSZipUtils.getBinaryContent(n.coverUrl,function(i,r){i?t.reject(i):(e.folder("EPUB").folder("images").file(n.options.coverFilename,r,{binary:!0}),t.resolve(""))}):t.resolve(!0),t.promise}function u(e,n){Handlebars.registerPartial("sectionsNCXTemplate",a.sectionsNCXTemplate),e.folder("EPUB").file("lightnovel.ncx",g(a.ncx,n))}function f(e,n){Handlebars.registerPartial("sectionsNavTemplate",a.sectionsNavTemplate),e.folder("EPUB").file("nav.html",g(a.nav,n))}function p(e,n){function t(){var t={original:n.stylesheet.replaceOriginal?"":a.css,custom:n.styles};e.folder("EPUB").folder("css").file("main.css",g("{{{original}}}{{{custom}}}",t,!0)),r.resolve(!0)}var r=i();return n.stylesheet.url?o(n.stylesheet.url).then(function(e){n.styles=e.data,t()}):(t(),r.promise)}function d(e,n){for(var t=[],r=0;r<n.additionalFiles.length;r++){var o=n.additionalFiles[r],a=new i;JSZipUtils.getBinaryContent(o.url,function(n,t){return function(i,r){i?t.reject(i):(e.folder("EPUB").folder(n.folder).file(n.filename,r,{binary:!0}),t.resolve(""))}}(o,a)),t.push(a.promise)}return i.all(t)}function h(e,n){n.needPage&&("auto-toc"==n.epubType?e.folder("EPUB").file(n.name+".html",g(a.autoToc,n)):e.folder("EPUB").file(n.name+".html",g(a.content,n)));for(var t=0;t<n.subSections.length;t++)h(e,n.subSections[t])}function m(e,n){for(var t=0;t<n.sections.length;t++)h(e,n.sections[t])}function g(e,n,t){function i(e){return t||"undefined"==typeof html_beautify?e:html_beautify(e,{end_with_newline:!1,indent_char:"\t",indent_inner_html:!0,indent_size:"1",preserve_newlines:!1,wrap_line_length:"0",unformatted:[],selector_separator_newline:!1,newline_between_rules:!0})}return i(Handlebars.compile(e)(n))}this.make=function(e){r.debug("building epub",e);var o=new JSZip,a=i();return n(e),i.all(t(o),s(o,e),c(o,e),l(o,e),d(o,e),u(o,e),f(o,e),p(o,e),m(o,e)).then(function(){a.resolve(o)},function(e){r.log(e)}),a.promise}};if("undefined"!=typeof n)n.exports.builder=new s;else if("undefined"!=typeof t)t.builder=new s;else if("undefined"==typeof window)throw new Error("unable to expose module: no module, exports object and no global window detected");"undefined"!=typeof window&&(window.epubMaker=new s)}()},{"../../js/util/ajax":7,"../../js/util/console":8,"d.js":3}],7:[function(e,n,t){!function(){"use strict";var t=e("d.js"),i=e("../../js/util/console")();n.exports=function(e,n){var r=t();try{var o=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");o.open(n?"POST":"GET",e,1),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){o.readyState>3&&r.resolve({data:o.responseText,xhr:o})},o.send(n)}catch(a){i.error(a),r.reject(a)}return r.promise}}()},{"../../js/util/console":8,"d.js":3}],8:[function(e,n,t){!function(){"use strict";function e(){}n.exports=function(){return"undefined"!=typeof console?console:{log:e,info:e,debug:e,warn:e,error:e}}}()},{}],9:[function(e,n,t){!function(){"use strict";function e(e){return e.substr(e.lastIndexOf(".")+1)}var n={jpeg:"image/jpeg",jpg:"image/jpeg",bmp:"image/bmp",png:"image/png",svg:"image/svg+xml",gif:"image/gif"};Handlebars.registerHelper("extension",function(n){return e(n)}),Handlebars.registerHelper("mimetype",function(t){return n[e(t)]})}()},{}],10:[function(e,n,t){!function(){"use strict";function e(e){return e.toLowerCase().replace(/\s\W/g,"-")}if(n.exports="undefined"!=typeof s&&s.slugify?s.slugify:e,
n.exports===e){var t="undefined"!=typeof console&&console.debug?console.debug:function(){};t.call(console,"underscore.string not found, falling back on (very) simple slugify..")}}()},{}]},{},[1]);